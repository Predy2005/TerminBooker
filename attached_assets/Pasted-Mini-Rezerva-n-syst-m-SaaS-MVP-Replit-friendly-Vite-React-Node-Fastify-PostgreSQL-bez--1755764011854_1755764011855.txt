Mini RezervaÄnÃ­ systÃ©m â€” SaaS MVP (Replitâ€‘friendly) â€” Vite React + Node (Fastify) + PostgreSQL (bez Prisma)

1) CÃ­l a hodnota

JednoduchÃ½ online rezervaÄnÃ­ systÃ©m pro jednotlivce a malÃ© provozy (trenÃ©Å™i, kadeÅ™nÃ­ci, fotografovÃ©, malÃ© kliniky). UmoÅ¾nÃ­ publikovat volnÃ© termÃ­ny, pÅ™ijÃ­mat rezervace a spravovat je v pÅ™ehlednÃ©m dashboardu.
	â€¢	Hodnota: mÃ©nÄ› telefonÃ¡tÅ¯ a zprÃ¡v, jednoduchÃ© plÃ¡novÃ¡nÃ­, export do CSV, potvrzovacÃ­ eâ€‘maily.
	â€¢	ZamÄ›Å™enÃ­ MVP: rychlÃ© nasazenÃ­, jednoduchÃ© workflow, CZ lokalizace.

2) Persony
	â€¢	Poskytovatel (Owner/Admin) â€“ zaklÃ¡dÃ¡ ÃºÄet/â€organizaciâ€œ, definuje sluÅ¾by, okna dostupnosti a spravuje rezervace.
	â€¢	ZÃ¡kaznÃ­k (Customer) â€“ na veÅ™ejnÃ© strÃ¡nce organizace vybere sluÅ¾bu, termÃ­n a provede rezervaci.

â¸»

3) Tech stack (Replitâ€‘friendly, bez Next.js a bez Prisma)
	â€¢	Frontend: Vite + React 18 + TypeScript, Tailwind CSS, React Hook Form + Zod, react-router-dom.
	â€¢	Backend: Node 20 + Fastify (rychlÃ©, typovanÃ©) + TypeScript.
	â€¢	DB: PostgreSQL (doporuÄeno Neon/Supabase free tier).
	â€¢	DB klient: pg (nodeâ€‘postgres) + migrace pÅ™es node-pg-migrate (Äi knex migrations).
	â€¢	Auth: JWT (HS256) v httpOnly cookie (SameSite=Lax).
	â€¢	Email: nodemailer + SMTP (Seznam Profi / jinÃ½ SMTP).
	â€¢	Rate limit: @fastify/rate-limit pro veÅ™ejnÃ© rezervace.
	â€¢	Build & run na Replitu: monorepo client/ + server/, skript pro paralelnÃ­ start (concurrently).

Struktura repozitÃ¡Å™e

mini-reservations/
â”œâ”€ client/                       # Vite React
â”‚  â”œâ”€ src/
â”‚  â”‚  â”œâ”€ app.tsx                # Router + layout
â”‚  â”‚  â”œâ”€ pages/
â”‚  â”‚  â”‚  â”œâ”€ PublicOrg.tsx       # veÅ™ejnÃ¡ strÃ¡nka /:orgSlug
â”‚  â”‚  â”‚  â”œâ”€ Dashboard.tsx       # pÅ™ehled dne/tÃ½dne
â”‚  â”‚  â”‚  â”œâ”€ Services.tsx        # CRUD sluÅ¾eb
â”‚  â”‚  â”‚  â”œâ”€ Availability.tsx    # Å¡ablony dostupnosti
â”‚  â”‚  â”‚  â”œâ”€ Blackouts.tsx       # blokace
â”‚  â”‚  â”‚  â”œâ”€ Bookings.tsx        # seznam + export
â”‚  â”‚  â”‚  â””â”€ AuthLogin.tsx / AuthRegister.tsx
â”‚  â”‚  â”œâ”€ components/
â”‚  â”‚  â”œâ”€ lib/api.ts             # fetch wrapper
â”‚  â”‚  â””â”€ styles.css
â”‚  â”œâ”€ index.html
â”‚  â””â”€ vite.config.ts
â”œâ”€ server/                       # Fastify API
â”‚  â”œâ”€ src/
â”‚  â”‚  â”œâ”€ index.ts               # bootstrap fastify
â”‚  â”‚  â”œâ”€ db.ts                  # pÅ™ipojenÃ­ k PG (pg Pool)
â”‚  â”‚  â”œâ”€ migrations/            # node-pg-migrate migraÄnÃ­ skripty
â”‚  â”‚  â”œâ”€ routes/
â”‚  â”‚  â”‚  â”œâ”€ auth.ts             # /api/auth/*
â”‚  â”‚  â”‚  â”œâ”€ org.ts              # /api/org
â”‚  â”‚  â”‚  â”œâ”€ services.ts         # /api/services
â”‚  â”‚  â”‚  â”œâ”€ availability.ts     # /api/availability
â”‚  â”‚  â”‚  â”œâ”€ blackouts.ts        # /api/blackouts
â”‚  â”‚  â”‚  â”œâ”€ bookings.ts         # /api/bookings (admin) + export CSV
â”‚  â”‚  â”‚  â””â”€ public.ts           # /api/public/:orgSlug/* (services, slots, booking)
â”‚  â”‚  â”œâ”€ lib/
â”‚  â”‚  â”‚  â”œâ”€ auth.ts             # JWT, hash hesla (argon2)
â”‚  â”‚  â”‚  â”œâ”€ email.ts            # nodemailer
â”‚  â”‚  â”‚  â”œâ”€ slots.ts            # generovÃ¡nÃ­ slotÅ¯
â”‚  â”‚  â”‚  â””â”€ validate.ts         # Zod schÃ©mata
â”‚  â”‚  â””â”€ types.d.ts
â”‚  â”œâ”€ package.json
â”‚  â””â”€ tsconfig.json
â”œâ”€ package.json                  # root skripty (dev:client, dev:server, dev)
â””â”€ .replit / replit.nix          # pro Replit


â¸»

4) DatovÃ½ model (SQL pro PostgreSQL)

Migrations: node-pg-migrate â€” nÃ­Å¾e jsou ukÃ¡zky schÃ©matu (DDL).

CREATE TABLE organizations (
  id            TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  name          TEXT NOT NULL,
  slug          TEXT UNIQUE NOT NULL,
  timezone      TEXT NOT NULL DEFAULT 'Europe/Prague',
  language      TEXT NOT NULL DEFAULT 'cs-CZ',
  created_at    TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at    TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE users (
  id               TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  email            TEXT UNIQUE NOT NULL,
  password_hash    TEXT NOT NULL,
  role             TEXT NOT NULL DEFAULT 'ADMIN',
  organization_id  TEXT NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
  created_at       TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE services (
  id               TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id  TEXT NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
  name             TEXT NOT NULL,
  duration_min     INT  NOT NULL CHECK (duration_min BETWEEN 5 AND 480),
  price_czk        INT,
  is_active        BOOLEAN NOT NULL DEFAULT TRUE,
  created_at       TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- TÃ½dennÃ­ Å¡ablony dostupnosti (0=nedÄ›le .. 6=sobota)
CREATE TABLE availability_templates (
  id               TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id  TEXT NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
  weekday          INT NOT NULL CHECK (weekday BETWEEN 0 AND 6),
  start_minutes    INT NOT NULL,  -- od pÅ¯lnoci
  end_minutes      INT NOT NULL,  -- do pÅ¯lnoci
  slot_step_min    INT NOT NULL,  -- krok slotÅ¯
  created_at       TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE blackouts (
  id               TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id  TEXT NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
  starts_at        TIMESTAMPTZ NOT NULL,
  ends_at          TIMESTAMPTZ NOT NULL,
  reason           TEXT
);

CREATE TYPE booking_status AS ENUM ('PENDING','CONFIRMED','CANCELLED');

CREATE TABLE bookings (
  id               TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id  TEXT NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
  service_id       TEXT NOT NULL REFERENCES services(id)       ON DELETE RESTRICT,
  customer_name    TEXT NOT NULL,
  customer_email   TEXT NOT NULL,
  customer_phone   TEXT,
  note             TEXT,
  starts_at        TIMESTAMPTZ NOT NULL,
  ends_at          TIMESTAMPTZ NOT NULL,
  status           booking_status NOT NULL DEFAULT 'PENDING',
  created_at       TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at       TIMESTAMPTZ NOT NULL DEFAULT now(),
  CONSTRAINT chk_time CHECK (starts_at < ends_at)
);

-- UnikÃ¡tnÃ­ pÅ™ekryv pro tutÃ©Å¾ organizaci ve stejnÃ©m slotu
CREATE UNIQUE INDEX ux_bookings_org_time ON bookings(organization_id, starts_at, ends_at);


â¸»

5) GenerovÃ¡nÃ­ slotÅ¯ (server/lib/slots.ts)
	1.	Na obdobÃ­ (napÅ™. dnes â†’ +14 dnÃ­) si pro kaÅ¾dÃ½ den vyÅ¾Ã¡dej Å¡ablony availability_templates.
	2.	Pro kaÅ¾dÃ½ den spoÄÃ­tej sloty po slot_step_min a filtruj tak, aby se celÃ¡ dÃ©lka sluÅ¾by veÅ¡la do okna start_minutes..end_minutes.
	3.	VyÅ™aÄ koliznÃ­ sloty: existujÃ­â€‘li bookings se statusem â‰  CANCELLED pÅ™ekrÃ½vajÃ­cÃ­ [starts_at, ends_at).
	4.	VyÅ™aÄ sloty spadajÃ­cÃ­ do blackouts.
	5.	Zohledni timezone organizace (pÅ™epoÄty pomocÃ­ luxon/date-fns-tz).

â¸»

6) API (Fastify routes)

Prefix: /api.

Auth
	â€¢	POST /api/auth/register â†’ vytvoÅ™Ã­ organization, admin user, nastavÃ­ httpOnly cookie.
	â€¢	POST /api/auth/login â†’ ovÄ›Å™Ã­ email/heslo (argon2), vydÃ¡ cookie.
	â€¢	POST /api/auth/logout â†’ smaÅ¾e cookie.

Organizace
	â€¢	GET /api/org â†’ detail pÅ™ihlÃ¡Å¡enÃ© organizace.
	â€¢	PATCH /api/org â†’ update name/slug/timezone/language (validace Zod).

SluÅ¾by
	â€¢	GET /api/services
	â€¢	POST /api/services
	â€¢	PATCH /api/services/:id
	â€¢	DELETE /api/services/:id

Dostupnost & Blackouty
	â€¢	GET /api/availability
	â€¢	POST /api/availability
	â€¢	DELETE /api/availability/:id
	â€¢	GET /api/blackouts
	â€¢	POST /api/blackouts
	â€¢	DELETE /api/blackouts/:id

VeÅ™ejnÃ©
	â€¢	GET /api/public/:orgSlug/services
	â€¢	GET /api/public/:orgSlug/slots?from=ISO&to=ISO&serviceId=...
	â€¢	POST /api/public/:orgSlug/bookings  (rateâ€‘limit + Zod validace)

Admin â€” rezervace
	â€¢	GET /api/bookings?from&to&serviceId&status
	â€¢	PATCH /api/bookings/:id (zmÄ›na stavu, poznÃ¡mka)
	â€¢	DELETE /api/bookings/:id (zruÅ¡enÃ­)
	â€¢	GET /api/bookings/export.csv?from&to&serviceId&status (Stream odpovÄ›Ä)

â¸»

7) Autentizace, cookies a CORS
	â€¢	JWT v httpOnly cookie session, SameSite=Lax, Secure v produkci.
	â€¢	CORS: povolit pÅ¯vod klienta z Replitu (URL klienta), hlaviÄky Content-Type, Authorization.
	â€¢	Ochrana proti CSRF: sameâ€‘site cookie + doubleâ€‘submit token pro citlivÃ© POSTy (skrytÃ½ input).

â¸»

8) Validace
	â€¢	Zod schÃ©mata: Service (name 2â€“80, duration 5â€“480), Booking (jmÃ©no 2â€“80, email validnÃ­), Äasy ISO8601.
	â€¢	Na DB Ãºrovni: chk_time, ux_bookings_org_time.
	â€¢	PÅ™i vytvÃ¡Å™enÃ­ rezervace nejdÅ™Ã­v SELECT kolizÃ­ v transakci; pokud kolize, vrÃ¡tit 409.

â¸»

9) Eâ€‘maily (nodemailer)
	â€¢	email.ts exportuje sendBookingConfirmation(to, booking, org) a sendBookingStatusChange(...).
	â€¢	Å ablony jednoduchÃ½ HTML (CZ). V dev reÅ¾imu log do konzole; v prod SMTP ze .env.

â¸»

10) Frontend (Vite React)
	â€¢	Public flow /org/:slug: vÃ½pis sluÅ¾eb â†’ vÃ½bÄ›r termÃ­nu (kalendÃ¡Å™ + Äasy) â†’ formulÃ¡Å™ â†’ ÃºspÄ›ch.
	â€¢	Dashboard /dashboard: pÅ™ehled dne/tÃ½dne, filtry (sluÅ¾ba, stav), CRUD sluÅ¾by/dostupnost/blackouty, seznam rezervacÃ­ + export.
	â€¢	UI knihovny volitelnÃ© (Headless UI / Radix). Tailwind pro rychlost.

â¸»

11) AkceptaÄnÃ­ kritÃ©ria MVP
	â€¢	VeÅ™ejnÃ½ flow: vytvoÅ™enÃ­ rezervace â†’ eâ€‘mail potvrzenÃ­ (logged v dev), nedojde k dvojÃ­ rezervaci.
	â€¢	Admin flow: registrace, login, zaloÅ¾enÃ­ org, vytvoÅ™enÃ­ sluÅ¾by a Å¡ablony dostupnosti, zobrazenÃ­ slotÅ¯, CSV export funguje.
	â€¢	Rateâ€‘limit brÃ¡nÃ­ spamu (napÅ™. 5/min/IP na POST booking).

â¸»

12) NasazenÃ­ a Replit nastavenÃ­
	â€¢	Env promÄ›nnÃ© (server):
	â€¢	DATABASE_URL=postgres://user:pass@host:5432/dbname
	â€¢	JWT_SECRET=...
	â€¢	SMTP_HOST=..., SMTP_PORT=..., SMTP_USER=..., SMTP_PASS=..., SMTP_FROM="NÃ¡zev <no-reply@domena.cz>"
	â€¢	CLIENT_ORIGIN=https://<tvoje-replit-client-url>
	â€¢	Env (client):
	â€¢	VITE_API_BASE=https://<tvoje-replit-server-url>/api
	â€¢	Scripts (root package.json):

{
  "scripts": {
    "dev": "concurrently \"npm:dev:server\" \"npm:dev:client\"",
    "dev:server": "npm --prefix server run dev",
    "dev:client": "npm --prefix client run dev"
  },
  "devDependencies": {"concurrently": "^9"}
}

	â€¢	Server package.json (vÃ½Åˆatek):

{
  "type": "module",
  "scripts": {
    "dev": "ts-node-dev --respawn --transpile-only src/index.ts",
    "migrate": "node-pg-migrate -j ts -d $DATABASE_URL -m src/migrations"
  },
  "dependencies": {
    "fastify": "^4",
    "@fastify/cors": "^9",
    "@fastify/cookie": "^9",
    "@fastify/rate-limit": "^10",
    "pg": "^8",
    "argon2": "^0.31",
    "zod": "^3",
    "nodemailer": "^6",
    "luxon": "^3"
  },
  "devDependencies": {
    "ts-node-dev": "^2",
    "typescript": "^5",
    "node-pg-migrate": "^7"
  }
}


â¸»

13) Seed a demo data
	â€¢	Org: Demo Salon (slug demo-salon), uÅ¾ivatel: admin@demo.cz / heslo â€adminâ€œ (jen dev).
	â€¢	SluÅ¾by: StÅ™ih 30 (30), BarvenÃ­ 60 (60).
	â€¢	Å ablony: Poâ€“PÃ¡ 09:00â€“17:00, krok 30 min.
	â€¢	2 ukÃ¡zkovÃ© rezervace v budoucnu.

â¸»

14) BudoucÃ­ PRO rozÅ¡Ã­Å™enÃ­
	â€¢	Online platby (Comgate/Stripe) â†’ stav PAID.
	â€¢	VÃ­ce zdrojÅ¯/kapacit (paralelnÃ­ bookovÃ¡nÃ­), zamÄ›stnanci.
	â€¢	SMS brÃ¡na (Twilio/GoSMS), iCal pozvÃ¡nky, Google Calendar sync.
	â€¢	Widget pro vloÅ¾enÃ­ na cizÃ­ web (iframe) + veÅ™ejnÃ© API klÃ­Äe.

â¸»

15) MilnÃ­ky
	â€¢	M1: Auth (register/login/logout) + org CRUD.
	â€¢	M2: SluÅ¾by + dostupnost + vÃ½poÄet slotÅ¯ (server) + veÅ™ejnÃ© endpointy.
	â€¢	M3: Rezervace endâ€‘toâ€‘end + eâ€‘maily + rateâ€‘limit.
	â€¢	M4: Dashboard pÅ™ehled + export CSV.
	â€¢	M5: Polishing, validace, demo seed a dokumentace.

â¸»

16) DalÅ¡Ã­ kroky (hned)
	1.	Inicializuj monorepo (client/server) a zÃ¡kladnÃ­ skripty dev (concurrently).
	2.	Na serveru: Fastify + @fastify/cookie, pÅ™ipoj pg Pool, pÅ™iprav migraÄnÃ­ framework (node-pg-migrate).
	3.	VytvoÅ™ prvnÃ­ migraci s tabulkami (viz vÃ½Å¡e) a spusÅ¥ na Neon/Supabase.
	4.	Implementuj /api/auth/register a /api/auth/login (argon2 + JWT cookie).
	5.	Na klientu: router, formulÃ¡Å™e (React Hook Form + Zod), strÃ¡nka /:orgSlug a /dashboard skeleton.
	6.	Implementuj vÃ½poÄet slotÅ¯ a veÅ™ejnÃ© rezervace; pÅ™idej eâ€‘mail potvrzenÃ­.

â¸»

ğŸ§¾ CenovÃ© plÃ¡ny, platebnÃ­ brÃ¡na a specifikace strÃ¡nek (pro Replit generovÃ¡nÃ­)

17) CenovÃ© plÃ¡ny (FREE / PRO / BUSINESS)

FREE (0 KÄ / mÄ›sÃ­c)
	â€¢	1 organizace, max. 1 sluÅ¾ba, max. 50 rezervacÃ­/mÄ›sÃ­c
	â€¢	VeÅ™ejnÃ¡ strÃ¡nka /:orgSlug
	â€¢	Eâ€‘mail potvrzenÃ­ rezervace (plain)
	â€¢	Export CSV

PRO (229 KÄ / mÄ›sÃ­c)
	â€¢	1 organizace, aÅ¾ 5 sluÅ¾eb, 1000 rezervacÃ­/mÄ›sÃ­c
	â€¢	VypnutÃ­ brandingu
	â€¢	VylepÅ¡enÃ© eâ€‘maily (logo, vlastnÃ­ odesÃ­latel)
	â€¢	Blackouty + tÃ½dennÃ­ Å¡ablony
	â€¢	PrioritnÃ­ rateâ€‘limit (vÃ­ce poÅ¾adavkÅ¯/min)

BUSINESS (649 KÄ / mÄ›sÃ­c)
	â€¢	NeomezenÃ© sluÅ¾by, neomezenÃ© rezervace/mÄ›sÃ­c (fÃ©rovÃ© pouÅ¾itÃ­)
	â€¢	VÃ­ce administrÃ¡torÅ¯ (do 5 uÅ¾ivatelÅ¯)
	â€¢	PÅ™Ã­prava na integrace (Google Calendar, webhooks)
	â€¢	PÅ™ednostnÃ­ podpora

Hodnoty lze mÄ›nit pÅ™es DB/konfig. Pro test ÃºÄely lze vynutit plÃ¡n ruÄnÄ› na organizations.plan.

Featureâ€‘flags (server)
	â€¢	ZÃ¡kladnÃ­ kontrola: middleware naÄte orgPlan a pÅ™edÃ¡ features do requestu.
	â€¢	Feature map:

// server/src/lib/features.ts
export const FEATURES = {
  FREE:     { maxServices: 1,  maxBookingsPerMonth: 50,   branding: true,  richEmail: false, admins: 1 },
  PRO:      { maxServices: 5,  maxBookingsPerMonth: 1000, branding: false, richEmail: true,  admins: 1 },
  BUSINESS: { maxServices: -1, maxBookingsPerMonth: -1,   branding: false, richEmail: true,  admins: 5 }
} as const;


â¸»

18) PlatebnÃ­ brÃ¡na

18.1 Provider abstrakce
	â€¢	MVP: Stripe (snadnÃ© SDK, testovacÃ­ reÅ¾im).
	â€¢	VolitelnÄ›: Comgate (CZ), pÅ™ipravit rozhranÃ­ BillingProvider a implementaci stripeProvider (MVP), comgateProvider (pozdÄ›ji).

18.2 Env promÄ›nnÃ© (server)

# Stripe
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
STRIPE_PRICE_PRO=price_xxx
STRIPE_PRICE_BUSINESS=price_yyy
BILLING_PROVIDER=stripe

# (BudoucÃ­) Comgate
COMGATE_MERCHANT=...
COMGATE_SECRET=...
COMGATE_TEST=1

18.3 DB schÃ©ma (migrace 0002_billing_up.sql)

-- plÃ¡n na organizaci (FREE/PRO/BUSINESS)
ALTER TABLE organizations ADD COLUMN plan TEXT NOT NULL DEFAULT 'FREE';
ALTER TABLE organizations ADD COLUMN subscription_status TEXT NOT NULL DEFAULT 'inactive';
ALTER TABLE organizations ADD COLUMN subscription_current_period_end TIMESTAMPTZ;

CREATE TABLE payments (
  id                TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id   TEXT NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
  provider          TEXT NOT NULL,     -- 'stripe' | 'comgate'
  external_id       TEXT NOT NULL,     -- session/payment id
  plan              TEXT NOT NULL,     -- 'PRO' | 'BUSINESS'
  amount_cents      INT  NOT NULL,
  currency          TEXT NOT NULL DEFAULT 'CZK',
  status            TEXT NOT NULL,     -- 'created' | 'paid' | 'failed' | 'refunded'
  created_at        TIMESTAMPTZ NOT NULL DEFAULT now(),
  paid_at           TIMESTAMPTZ,
  raw_payload       JSONB
);

CREATE TABLE webhook_events (
  id              TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  provider        TEXT NOT NULL,
  event_type      TEXT NOT NULL,
  received_at     TIMESTAMPTZ NOT NULL DEFAULT now(),
  payload         JSONB
);

18.4 API (billing)
	â€¢	POST /api/billing/checkout body: { plan: 'PRO'|'BUSINESS' } â†’ vrÃ¡tÃ­ { url } (Stripe Checkout URL)
	â€¢	POST /api/billing/webhook (bez auth) â€“ ovÄ›Å™enÃ­ podpisu, zmÄ›na organizations.plan, subscription_status, zÃ¡znam do payments a webhook_events.
	â€¢	GET /api/billing/status â†’ vracÃ­ aktivnÃ­ plÃ¡n a stav pÅ™edplatnÃ©ho pro pÅ™ihlÃ¡Å¡enou org.
	â€¢	GET /api/billing/portal (nepovinnÃ©) â†’ Stripe Customer Portal (pro zmÄ›nu karty/ruÅ¡enÃ­).

18.5 Flow
	1.	Admin v /dashboard/billing vybere plÃ¡n (PRO/BUSINESS) â†’ volÃ¡ POST /api/billing/checkout â†’ pÅ™esmÄ›ruje na Stripe Checkout.
	2.	Platba ÃºspÄ›Å¡nÃ¡ â†’ Stripe pÅ™esmÄ›ruje na /billing/success?session_id=....
	3.	Stripe webhook poÅ¡le event (checkout.session.completed / invoice.paid) na /api/billing/webhook â†’ server nastavÃ­ organizations.plan = PRO|BUSINESS, subscription_status='active' a uloÅ¾Ã­ payments.
	4.	UI v /dashboard/billing ukÃ¡Å¾e aktivnÃ­ plÃ¡n + moÅ¾nost nÃ¡vratu na Free (zruÅ¡enÃ­ v Portalu nebo pÅ™es podporu).

V MVP vyuÅ¾ij Stripe emailovÃ© ÃºÄtenky; vlastnÃ­ â€fakturyâ€œ lze doplnit pozdÄ›ji.

â¸»

19) PÅ™Ã­stupovÃ¡ pravidla podle plÃ¡nu
	â€¢	VytvoÅ™enÃ­ sluÅ¾by (POST /api/services): kontroluj features.maxServices.
	â€¢	VytvoÅ™enÃ­ rezervace: mÄ›sÃ­ÄnÃ­ limit na zÃ¡kladÄ› features.maxBookingsPerMonth.
	â€¢	Admin poÄet uÅ¾ivatelÅ¯: kontrola v CRUD users (BUSINESS aÅ¾ 5).
	â€¢	Branding: na public strÃ¡nce /:orgSlug skrÃ½t/ukÃ¡zat footer â€Powered by â€¦â€œ.

â¸»

20) StrÃ¡nky a chovÃ¡nÃ­ (detailnÃ­ popis pro Replit)

20.1 VeÅ™ejnÃ¡ strÃ¡nka organizace /:orgSlug
	â€¢	Zobrazuje nÃ¡zev organizace, seznam aktivnÃ­ch sluÅ¾eb (nÃ¡zev, dÃ©lka, cena), kalendÃ¡Å™, dostupnÃ© Äasy.
	â€¢	Akce: uÅ¾ivatel vybere sluÅ¾bu â†’ datum â†’ Äas â†’ vyplnÃ­ jmÃ©no, eâ€‘mail, telefon (volitelnÃ©) â†’ odeÅ¡le.
	â€¢	Validace: jmÃ©no 2â€“80, eâ€‘mail validnÃ­, antiâ€‘spam (honeypot + rateâ€‘limit).
	â€¢	Odezva: po ÃºspÄ›chu zobrazit â€Rezervace pÅ™ijata, potvrzenÃ­ odeÅ¡leme eâ€‘mailem.â€œ

20.2 PÅ™ihlÃ¡Å¡enÃ­/registrace /auth/login, /auth/register
	â€¢	Register: zaloÅ¾Ã­ organizaci (name, slug, timezone), admin uÅ¾ivatele, nastavÃ­ cookie.
	â€¢	Login: email + heslo, cookie httpOnly, redirect na /dashboard.

20.3 Dashboard /dashboard
	â€¢	PÅ™ehled dne/tÃ½dne, filtry podle sluÅ¾by a stavu, rychlÃ© potvrzenÃ­/zruÅ¡enÃ­ rezervace.

20.4 SluÅ¾by /dashboard/services
	â€¢	CRUD: nÃ¡zev, dÃ©lka, cena (CZK), aktivnÃ­/disabled.
	â€¢	Gating: na FREE zakÃ¡zat vytvoÅ™it >1 sluÅ¾bu.

20.5 Dostupnost /dashboard/availability
	â€¢	CRUD tÃ½dennÃ­ch Å¡ablon (Poâ€“Ne, odâ€“do, krok slotu 15/30/60 min).
	â€¢	UkÃ¡zat nÃ¡hled slotÅ¯ na vybranÃ½ den.

20.6 Blackouty /dashboard/blackouts
	â€¢	Blokace dnÅ¯/ÄasÅ¯ (dovolenÃ¡, svÃ¡tek). Kolize se sloty â€“ sloty se nevracÃ­.

20.7 Rezervace /dashboard/bookings
	â€¢	Seznam, stavy (PENDING/CONFIRMED/CANCELLED), vyhledÃ¡vÃ¡nÃ­, filtrovÃ¡nÃ­.
	â€¢	Export CSV tlaÄÃ­tkem â†’ stÃ¡hne stream.

20.8 Billing /dashboard/billing
	â€¢	Zobrazit aktuÃ¡lnÃ­ plÃ¡n, limity, a CTA na upgrade.
	â€¢	Karty plÃ¡nÅ¯ (PRO, BUSINESS) â†’ tlaÄÃ­tko â€PokraÄovat k platbÄ›â€œ â†’ POST /api/billing/checkout â†’ redirect URL (Stripe Checkout).
	â€¢	Po nÃ¡vratu ze Stripe zobrazenÃ­ vÃ½sledku: /billing/success nebo /billing/cancel.
	â€¢	Zobrazit historii plateb (tabulka z payments).

20.9 StrÃ¡nky vÃ½sledku plateb
	â€¢	/billing/success â€“ naÄte session_id z query, potvrdÃ­ serverem (volitelnÃ½ GET /api/billing/status), ukÃ¡Å¾e â€PlÃ¡n aktivnÃ­â€œ.
	â€¢	/billing/cancel â€“ informace o zruÅ¡enÃ­, tlaÄÃ­tko zpÄ›t na /dashboard/billing.

â¸»

21) API â€“ doplnÄ›nÃ­ (pro Replit autoâ€‘gen)

POST   /api/billing/checkout          { plan } â†’ { url }
POST   /api/billing/webhook           (Stripe podpis)
GET    /api/billing/status            â†’ { plan, subscription_status, current_period_end }
GET    /api/billing/portal            â†’ { url } (nepovinnÃ©)

GET    /api/public/:orgSlug/services
GET    /api/public/:orgSlug/slots?from=ISO&to=ISO&serviceId=...
POST   /api/public/:orgSlug/bookings  { name,email,phone?,note,serviceId,startsAt }

GET    /api/services
POST   /api/services
PATCH  /api/services/:id
DELETE /api/services/:id

GET    /api/availability
POST   /api/availability
DELETE /api/availability/:id

GET    /api/blackouts
POST   /api/blackouts
DELETE /api/blackouts/:id

GET    /api/bookings?from&to&serviceId&status
PATCH  /api/bookings/:id
DELETE /api/bookings/:id
GET    /api/bookings/export.csv?from&to&serviceId&status


â¸»

22) AkceptaÄnÃ­ kritÃ©ria (billing)
	â€¢	UÅ¾ivatel na FREE vidÃ­ gating (pÅ™esÃ¡hneâ€‘li limit, dostane 402/forbidden s friendly hlÃ¡Å¡kou).
	â€¢	Checkout PRO/BUSINESS pÅ™esmÄ›ruje na Stripe a po ÃºspÄ›chu webhook nastavÃ­ plÃ¡n na org.
	â€¢	/dashboard/billing zobrazuje aktivnÃ­ plÃ¡n a poslednÃ­ platby.
	â€¢	Rateâ€‘limit a antiâ€‘spam je ÃºÄinnÃ½ na POST /api/public/:orgSlug/bookings.

â¸»

23) TestovacÃ­ scÃ©nÃ¡Å™e
	1.	Registrace org, vytvoÅ™enÃ­ 1 sluÅ¾by, vytvoÅ™enÃ­ 55 rezervacÃ­ â†’ poslednÃ­ch 5 na FREE selÅ¾e (limit 50).
	2.	Upgrade na PRO â†’ limit povolen, branding vypnut, eâ€‘maily s logem.
	3.	VytvoÅ™enÃ­ 6. sluÅ¾by na PRO â†’ selÅ¾e (limit 5) â†’ po upgradu na BUSINESS projde.
	4.	Webhook bez podpisu â†’ 400; webhook s validnÃ­m podpisem zmÄ›nÃ­ plÃ¡n a zapÃ­Å¡e platbu.

â¸»

24) PoznÃ¡mky k nasazenÃ­
	â€¢	Na Replitu drÅ¾ SECRET klÃ­Äe v Secrets.
	â€¢	V testu pouÅ¾ij Stripe test kartu 4242 4242 4242 4242.
	â€¢	Pro CZK ceny vytvoÅ™ Products/Prices ve Stripe a hodnoty vloÅ¾ do env (STRIPE_PRICE_PRO, STRIPE_PRICE_BUSINESS).